<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    
    <title>Kitchen Duty Planning REST Resource ~ Planning Page | Plugin Development Tutorial for Atlassian JIRA® | Kitchen Duty Plugin by comSysto</title>
    <meta description="An interactive step-by-step tutorial on how to write Plugins for Atlassian JIRA® by comSysto">
    <meta name="robots" content="noindex, nofollow">


    
    <meta property="og:title" content="Kitchen Duty Plugin for Atlassian JIRA® by comSysto" />
    <meta property="og:image" content="https://comsysto.github.io/kitchen-duty-plugin-for-atlassian-jira/images/kitchen-duty-plugin--social.jpg" />
    <meta property="og:description" content="An interactive tutorial on how to write Plugins for Atlassian JIRA® by comSysto" />

    
    <link rel="canonical" href="https://comsysto.github.io/kitchen-duty-plugin-for-atlassian-jira/tutorial/07-step-04-planning-page--kitchen-duty-planning-rest-resource/" />

    <link rel="alternate" type="application/rss+xml" title="Kitchen Duty Plugin News" href="https://comsysto.github.io/kitchen-duty-plugin-for-atlassian-jira/rss_feed.xml" />



    <link href="/kitchen-duty-plugin-for-atlassian-jira/generated/bundle.css" rel="stylesheet">

    <link rel="icon" href="/kitchen-duty-plugin-for-atlassian-jira/images/favicon-32.png" type="image/png" sizes="32x32">
    <link rel="icon" href="/kitchen-duty-plugin-for-atlassian-jira/images/favicon-256.png" type="image/png" sizes="256x256">
    <link rel="icon" href="/kitchen-duty-plugin-for-atlassian-jira/images/favicon.svg" type="image/svg+xml">

    <script>var postLoadMethods = [];</script>
</head>
<body class="cs-tutorial-body">























<div class="container-fluid cs-page-header">
    <div class="row">
        <div class="col-md-5 cs-page-header--left-fix">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/" class="cs-page-logo">
                <span class="cs-page-logo-img hidden-md-down"></span>
                <h1>Kitchen Duty Plugin</h1>
                <h2>for Atlassian JIRA® by comSysto</h2>
            </a>
        </div>
        <div class="col-md-3 text-xs-center hidden-sm-down">
            <a class="btn btn-primary cs-stars-on-github-give-star-button" href="https://github.com/comsysto/kitchen-duty-plugin-for-atlassian-jira" target="_blank">
                <span class="cs-stars-on-github-count-stars"></span>
                <i class="fa fa-star"></i>
                <span class="cs-stars-on-github-right hidden-md-down">Star on GitHub</span>
            </a>

            <a class="btn btn-primary" href="/kitchen-duty-plugin-for-atlassian-jira/news/" target="_blank">
                <span class="cs-news-right hidden-md-down">news</span>
            </a>
        </div>
        <div class="col-md-4  hidden-sm-down cs-page-header-cs-logo text-xs-right cs-page-header--right-fix">
            <a href="https://comsysto.com/leistungen/atlassian-experts-services" target="_blank"><img src="/kitchen-duty-plugin-for-atlassian-jira/images/comsysto-logo.png" alt="comSysto"/></a>
        </div>
    </div>

</div>

<!-- CONTENT -->



<div class="cs-sidebar-wrapper hidden-md-down">
    
<div id="toc">
    <ul>

        

        <li class="toc-h2 "><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/01-introduction/">
        Introduction
    </a>
        </li>
        <li class="toc-h2 "><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/02-step-00-getting-started/">
        <span class="cs-step-badge pull-right">0</span>
        Getting Started
    </a>
        </li>

        

        <li class="toc-h2-divider">Part I: Kitchen Duty Planning Page</li>

        <li class="toc-h2 "><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/03-story-workshop-for-planning-page/">
        Story Workshop for Planning Page
    </a>
        </li>
        <li class="toc-h2 "><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/04-step-01-planning-page--webwork-action-and-html-view/">
        <span class="cs-step-badge pull-right">1</span>
        Webwork Action and HTML View
    </a>
        </li>
        <li class="toc-h2 "><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/05-step-02-planning-page--user-search-rest-resource/">
        <span class="cs-step-badge pull-right">2</span>
        User Search REST Resource
    </a>
        </li>
        <li class="toc-h2 "><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/06-step-03-planning-page--user-search-js-controller/">
        <span class="cs-step-badge pull-right">3</span>
        User Search JS Controller
    </a>
        </li>
        <li class="toc-h2 toc-active"><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/07-step-04-planning-page--kitchen-duty-planning-rest-resource/">
        <span class="cs-step-badge pull-right">4</span>
        Kitchen Duty Planning REST Resource
    </a>
        </li>
        <li class="toc-h2 "><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/08-step-05-planning-page--kitchen-duty-planning-js-controller/">
        <span class="cs-step-badge pull-right">5</span>
        Kitchen Duty Planning JS Controller
    </a>
        </li>
        
        <li>
            
            
            
            
            
            
            
            
            <p>&nbsp;</p>
            <div class="cs-toc-infographic-wrapper">
                
<svg class="cs-interactive-graphic"
     id="navSvg11"
     data-json-settings="{
            &quot;markedAsDone&quot;: [ &quot;webwork-action&quot;, &quot;html-view&quot;, &quot;user-resource&quot;, &quot;user-search-resource-model&quot;, &quot;user-js-controller&quot; ],
            &quot;markedAsTodo&quot;: [ &quot;kitchen-duty-resource&quot;, &quot;kitchen-duty-planning-model&quot; ],
            &quot;markedAsGrayedOut&quot;: [ ],
            &quot;onClick&quot;: [ ]
            }"
     data-svg-to-load="kitchen-duty-planning-page--component-overview"
     viewBox="0 0 1043 654"
     preserveAspectRatio="xMaxYMax">
</svg>

            </div>
        </li>
        

        

        <li class="toc-h2-divider">Part II: Kitchen Duty Overview Page</li>
        <li class="toc-h2 "><a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/09-story-workshop-for-overview-page/">
        Story Workshop for Overview Page
    </a>
        </li>
    </ul>




</div>


</div>

<div class="cs-content-wrapper">
    



<div class="row">
    <div class="col-md-12">
        




<h2 class="cs-headline cs-headline--m cs-headline--anchor"
    data-scroll-to-headline="kitchen-duty-planning-rest-resource"
    data-scroll-to-headline-previous="">
    
    Kitchen Duty Planning REST Resource
</h2>


        
        
        

        <div class="alert alert-danger">THIS PAGE IS UNDER CONSTRUCTION. WORK IN PROGRESS</div>

        <p>Basically we will build the <strong>Kitchen Duty Planning REST Resource</strong> and the <strong>Kitchen Duty Planning REST Model</strong>
            which will persist our selected weeks and users to the database.</p>

        <p>You also might want to look into <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/03-story-workshop-for-planning-page/">the Story Workshop</a> again to recapitulate what we are going to build now.</p>

        <div class="alert alert-info">This chapter heavily depends on the <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/05-step-02-planning-page--user-search-rest-resource/">configuration done in Step 2</a>.</div>

        <h3 class="cs-headline cs-headline--s">What do we need exactly?</h3>

        <div class="row">
            <div class="col-md-6">
                <p>
                    After some serious brain usage on how to store the actual data of <strong>&laquo;who has Kitchen Duty in which week?&raquo;</strong>
                    I came up with the <strong>Data-Model</strong> seen on the right.</p>
                <p>
                    The <strong>Week</strong> will be the actual week number in the year. With a little thinking ahead of how I want to use it in the JS Controller
                    I basically will select a week via a date picker and <a href="http://momentjs.com/docs/#/get-set/iso-week/">calculate the isoWeek in the frontend using moment.js</a></p>
                <p>
                    The <strong>User</strong> part is obvious. We will need to store a list of usernames in the database in relation with a isoWeek (<a href="https://en.wikibooks.org/wiki/Java_Persistence/OneToMany"><code>@OneToMany</code></a>).
                </p>
                <p>
                    Concerning the <strong>REST Endpoint</strong> I will want to have an URL which I can fire
                    GET requests on something like <code>/planning/week/15</code> and receive a list of users.
                </p>
                <p>
                    Obviously the other way round would be a POST request on <code>/planning/week/15</code> with a list of users
                    as request body to store the user list for the week 15.
                </p>

                <p>
                    And for our stretch-goal a GET request on <code>/planning/user/bob</code> should return a list of week numbers
                    in which Bob has Kitchen Duty.
                </p>
            </div>
            <div class="col-md-offset-1 col-md-5">
                <table class="table table-bordered cs-table-uml">
                    <thead>
                    <tr>
                        <th>Week</th>
                        <th class="cs-table-uml--connector">
                            n&nbsp;&nbsp;&nbsp;&nbsp;1
                        </th>
                        <th>User</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>isoWeek: Integer</td>
                        <td class="cs-table-uml--blank"></td>
                        <td>username: String</td>
                    </tr>
                    </tbody>
                </table>
                <br>
                <br>
                <div style="padding:0 60px 0 60px">
                    <img src="/kitchen-duty-plugin-for-atlassian-jira/images/uml.jpg" class="img-fluid" style="max-width:250px">
                </div>
            </div>
        </div>

        <h3 class="cs-headline cs-headline--s">How exactly do we persist our data?</h3>

        <div class="row">
            <div class="col-md-7">

                <p>Alright we now how we want to use our REST Endpoint from the perspective of the JS Controller. And we have some kind of clue
                    on how the data should be stored theoretically.</p>

                <p>There are some possibilities to persist data in JIRA. </p>

                <!--
                TODO:
                <p>SAL + PluginSettingsFactory
                    <hr>
                    https://developer.atlassian.com/docs/common-coding-tasks/storing-plugin-settings</p>

                <p>
                    Active Objects:
                    <hr>
                    Reasons why: https://developer.atlassian.com/docs/atlassian-platform-common-components/active-objects
                    <hr>
                    https://developer.atlassian.com/docs/atlassian-platform-common-components/active-objects/getting-started-with-active-objects
                    <hr>
                    https://developer.atlassian.com/docs/atlassian-platform-common-components/active-objects/developing-your-plugin-with-active-objects
                </p>
                -->

            </div>
            <div class="col-md-5">
                <div style="padding:0 60px 0 60px">
                    <img src="/kitchen-duty-plugin-for-atlassian-jira/images/persist-data-in-jira.jpg" class="img-fluid" style="max-width:250px">
                </div>
            </div>
        </div>


        <h3 class="cs-headline cs-headline--s">Creating the Kitchen Duty Planning REST Resource</h3>

        <p>We will create the Kitchen Duty Planning REST Resource which will interact with the JS Controller to load and store the Kitchen Duty Planning REST Model.</p>

        

<div class="cs-code-filename">
    
    <span class="hidden-md-down">src/main/java/com/comsysto/kitchen/duty/rest/</span><span class="hidden-lg-up"
                                                            data-toggle="tooltip"
                                                            data-placement="right"
                                                            title="src/main/java/com/comsysto/kitchen/duty/rest/">.../</span>KitchenDutyPlanningResource.java
    
    
    <a href="https://github.com/comsysto/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-04-kitchen-duty-plugin/src/main/java/com/comsysto/kitchen/duty/rest/KitchenDutyPlanningResource.java" target="_blank"
       data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
       class="cs-code-ghlink"><i class="fa fa-github"></i></a>
    
    <a class="cs-code-copylink cs--trigger-copy-clipboard"
       data-toggle="tooltip" data-placement="left"
       data-title-orig="Copy file content to clipboard"
       title="Copy file content to clipboard"
       data-clipboard-text="package com.comsysto.kitchen.duty.rest;

import com.atlassian.plugins.rest.common.security.AnonymousAllowed;

import javax.inject.Inject;
import javax.inject.Named;
import javax.servlet.http.HttpServletRequest;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;
import javax.ws.rs.core.Context;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import java.util.ArrayList;
import java.util.List;

@Named
@Path(&quot;/planning&quot;)
public class KitchenDutyPlanningResource {


    @GET
    @Path(&quot;/health&quot;)
    @Produces({MediaType.APPLICATION_JSON})
    @AnonymousAllowed
    public Response health() {
        return Response.ok(&quot;ok&quot;).build();
    }

}"><i class="fa fa-files-o"></i></a>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-keyword">package</span> com.comsysto.kitchen.duty.rest;

<span class="hljs-keyword">import</span> com.atlassian.plugins.rest.common.security.AnonymousAllowed;

<span class="hljs-keyword">import</span> javax.inject.Inject;
<span class="hljs-keyword">import</span> javax.inject.Named;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.ws.rs.GET;
<span class="hljs-keyword">import</span> javax.ws.rs.Path;
<span class="hljs-keyword">import</span> javax.ws.rs.Produces;
<span class="hljs-keyword">import</span> javax.ws.rs.QueryParam;
<span class="hljs-keyword">import</span> javax.ws.rs.core.Context;
<span class="hljs-keyword">import</span> javax.ws.rs.core.MediaType;
<span class="hljs-keyword">import</span> javax.ws.rs.core.Response;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-annotation">@Named</span>
<span class="hljs-annotation">@Path</span>(<span class="hljs-string">"/planning"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KitchenDutyPlanningResource</span> </span>{


    <span class="hljs-annotation">@GET</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"/health"</span>)
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_JSON})
    <span class="hljs-annotation">@AnonymousAllowed</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">health</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> Response.ok(<span class="hljs-string">"ok"</span>).build();
    }

}</code></pre>


        <h3 class="cs-headline cs-headline--s">Creating the Kitchen Duty Planning REST Model</h3>

        <p>Now we create the model which will be used to persist data to the database.</p>

        

<div class="cs-code-filename">
    
    <span class="hidden-md-down">src/main/java/com/comsysto/kitchen/duty/rest/</span><span class="hidden-lg-up"
                                                            data-toggle="tooltip"
                                                            data-placement="right"
                                                            title="src/main/java/com/comsysto/kitchen/duty/rest/">.../</span>KitchenDutyPlanningModel.java
    
    
    <a href="https://github.com/comsysto/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-04-kitchen-duty-plugin/src/main/java/com/comsysto/kitchen/duty/rest/KitchenDutyPlanningModel.java" target="_blank"
       data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
       class="cs-code-ghlink"><i class="fa fa-github"></i></a>
    
    <a class="cs-code-copylink cs--trigger-copy-clipboard"
       data-toggle="tooltip" data-placement="left"
       data-title-orig="Copy file content to clipboard"
       title="Copy file content to clipboard"
       data-clipboard-text="package com.comsysto.kitchen.duty.rest;

import javax.xml.bind.annotation.*;
@XmlRootElement(name = &quot;planning&quot;)
@XmlAccessorType(XmlAccessType.FIELD)
public class KitchenDutyPlanningModel {

    @XmlElement
    private Integer isoWeek;

    @XmlElement
    @XmlRootElement(name = &quot;users&quot;)
    private List&lt;String&gt; users;

    public KitchenDutyPlanningModel() {
    }

	// TODO: getters/setters
}"><i class="fa fa-files-o"></i></a>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-keyword">package</span> com.comsysto.kitchen.duty.rest;

<span class="hljs-keyword">import</span> javax.xml.bind.annotation.*;
<span class="hljs-annotation">@XmlRootElement</span>(name = <span class="hljs-string">"planning"</span>)
<span class="hljs-annotation">@XmlAccessorType</span>(XmlAccessType.FIELD)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KitchenDutyPlanningModel</span> </span>{

    <span class="hljs-annotation">@XmlElement</span>
    <span class="hljs-keyword">private</span> Integer isoWeek;

    <span class="hljs-annotation">@XmlElement</span>
    <span class="hljs-annotation">@XmlRootElement</span>(name = <span class="hljs-string">"users"</span>)
    <span class="hljs-keyword">private</span> List&lt;String&gt; users;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">KitchenDutyPlanningModel</span><span class="hljs-params">()</span> </span>{
    }

	<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> getters/setters</span>
}</code></pre>


        <p>We will <strong>store the ISO Calender Week Number</strong> together with <strong>a list of users</strong>.
            Such and entry represents a Kitchen Duty entry for a certain week with the persons that have Kitchen Duty.</p>


        <div class="alert alert-danger">THIS PAGE IS UNDER CONSTRUCTION. WORK IN PROGRESS</div>


        <!--
                <div class="cs-v-spacer"></div>
                <div class="cs-tutorial-step-review">
                    <div class="cs-tutorial-step-review__headline">
                        <strong>You have completed Step 4.</strong> Good Job! You can check out this steps solution on GitHub
                    </div>
                    <div class="cs-tutorial-step-review__link">
                        <a href="https://github.com/comsysto/kitchen-duty-plugin-for-atlassian-jira/tree/master/step-04-kitchen-duty-plugin">
                            https://github.com/comsysto/kitchen-duty-plugin-for-atlassian-jira/tree/master/step-04-kitchen-duty-plugin
                        </a>
                    </div>
                </div>
                <div class="cs-v-spacer"></div>
                <p>The graphic shows marked green <strong>which components we implemented in this section</strong>.</p>
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-10 col-lg-offset-1 col-xl-8 col-xl-offset-2">
                        
<svg class="cs-interactive-graphic"
     id="p07-ig01"
     data-json-settings="{
                            &quot;markedAsDone&quot;: [ &quot;webwork-action&quot;, &quot;html-view&quot;, &quot;user-resource&quot;, &quot;user-search-resource-model&quot;, &quot;user-js-controller&quot;, &quot;kitchen-duty-resource&quot;, &quot;kitchen-duty-planning-model&quot; ],
                            &quot;markedAsTodo&quot;: [  ],
                            &quot;markedAsGrayedOut&quot;: [ ],
                            &quot;onClick&quot;: [ ]
                        }"
     data-svg-to-load="kitchen-duty-planning-page--component-overview"
     viewBox="0 0 1043 654"
     preserveAspectRatio="xMaxYMax">
</svg>

                    </div>
                </div>
        -->
        <div class="cs-v-spacer cs-v-spacer--big"></div>
        <div class="cs-v-spacer cs-v-spacer--big"></div>

    </div>
</div>



</div>



<div class="cs-footer">
    <div class="cs-footer-left">
        <a class="cs-grey-footer-link" href="/kitchen-duty-plugin-for-atlassian-jira/author-and-license/">Author &amp; License</a> &middot;
        <a class="cs-grey-footer-link" href="/kitchen-duty-plugin-for-atlassian-jira/impressum-and-datenschutz/">Impressum &amp; Datenschutz</a>
        &middot;
        <a class="cs-grey-footer-link" href="/kitchen-duty-plugin-for-atlassian-jira/impressum-and-datenschutz/">Privacy</a>
    </div>
    <div class="cs-footer-right">
        <div class="container-fluid ">
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 cs-pager cs-page-header--left-fix">
                            <a class="btn btn-primary" href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/06-step-03-planning-page--user-search-js-controller/"><i class="fa fa-angle-left"></i>
                                <span class="hidden-sm-down">previous page</span></a>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-xs-right cs-pager cs-page-header--right-fix">
                            
                            <a class="btn btn-primary" href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/08-step-05-planning-page--kitchen-duty-planning-js-controller/">
                                <span class="hidden-sm-down">next page</span>
                                <i class="fa fa-angle-right"></i></a>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>







<script src="/kitchen-duty-plugin-for-atlassian-jira/generated/bundle.js" async></script>




<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
<script>
    WebFont.load({
        google: {
            families: [ 'Menlo',
                'Open+Sans:400,300,600,700,800',
                'Roboto:400,900,700',
                'Source+Sans+Pro:400,300,600',
                'Patrick+Hand'
            ]
        }
    });
</script>
</body>
</html>
